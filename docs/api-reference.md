# API Reference

This document covers all endpoints and MCP tools generated by OpenAgentShop.

## MCP Tools

### Product Discovery

#### `list_products`

List and filter products from the catalog.

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `keyword` | string | No | Search keyword for name/description |
| `tier` | enum | No | Filter by product tier (if tiers defined) |
| `category` | enum | No | Filter by category (if categories defined) |
| `activeOnly` | boolean | No | Only show active products (default: true) |
| *filterable attrs* | string | No | Any custom attribute marked `filterable: true` |

**Returns:** Text summary + MCP-UI product list HTML

---

#### `get_product`

Get detailed information about a specific product.

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `productId` | number | Yes | The product ID |

**Returns:** Text summary + MCP-UI product detail HTML

---

#### `recommend_products`

Get product recommendations based on preferences.

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `budget` | number | No | Maximum budget in major currency units |
| `preferredTier` | enum | No | Preferred tier (if tiers defined) |
| `keyword` | string | No | What the customer is looking for |

**Returns:** Ranked list + MCP-UI recommendations HTML

---

### UCP Checkout

#### `create_checkout`

Create a new UCP checkout session.

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `meta` | object | No | UCP agent metadata |
| `meta.ucp-agent.profile` | string | No | Platform profile URL |
| `meta.idempotency-key` | string | No | Idempotency key |
| `checkout` | object | Yes | Checkout data |
| `checkout.buyer` | object | No | Buyer information |
| `checkout.buyer.email` | string | No | Buyer email |
| `checkout.buyer.first_name` | string | No | Buyer first name |
| `checkout.buyer.last_name` | string | No | Buyer last name |
| `checkout.line_items` | array | Yes | Items to purchase |
| `checkout.line_items[].item.id` | string | Yes | Product ID or catalog slug |
| `checkout.line_items[].quantity` | number | No | Quantity (default: 1) |

**Returns:** UCP checkout response JSON

---

#### `get_checkout`

Retrieve the current state of a checkout session.

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `id` | string | Yes | Checkout session ID |

**Returns:** UCP checkout response JSON

---

#### `update_checkout`

Update buyer information or line items on a checkout session. Uses full replacement semantics for provided fields.

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `id` | string | Yes | Checkout session ID |
| `buyer` | object | No | Updated buyer information |
| `line_items` | array | No | Replacement line items |

**Returns:** UCP checkout response JSON with recalculated status

---

#### `complete_checkout`

Finalize a checkout session and create an order. Session must be in `ready_for_complete` status.

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `id` | string | Yes | Checkout session ID |
| `idempotency-key` | string | No | Idempotency key for safe retries |

**Returns:** UCP checkout response JSON with `status: "completed"` and order metadata. Includes MCP-UI order confirmation HTML.

---

#### `cancel_checkout`

Cancel a checkout session. Cannot cancel completed or already canceled sessions.

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `id` | string | Yes | Checkout session ID |
| `idempotency-key` | string | No | Idempotency key |

**Returns:** UCP checkout response JSON with `status: "canceled"`

---

## HTTP API Endpoints

### MCP Server

| Method | Endpoint | Description |
|--------|----------|-------------|
| `POST` | `/api/mcp` | MCP JSON-RPC endpoint (tool calls, initialize) |
| `GET` | `/api/mcp` | Health check (no session) or SSE (with session) |
| `DELETE` | `/api/mcp` | Session cleanup |
| `OPTIONS` | `/api/mcp` | CORS preflight |

### Merchant API

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/merchant/products` | List all products |
| `POST` | `/api/merchant/products` | Create a product |
| `GET` | `/api/merchant/products/:id` | Get product with media |
| `PATCH` | `/api/merchant/products/:id` | Update product fields |
| `DELETE` | `/api/merchant/products/:id` | Delete product |
| `GET` | `/api/merchant/orders` | List all orders with product names |

### Commerce Feed

| Method | Endpoint | Query Params | Description |
|--------|----------|--------------|-------------|
| `GET` | `/api/feed` | `activeOnly`, `compress` | JSONL product feed |

### UCP Discovery

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/.well-known/ucp` | UCP platform profile |
| `OPTIONS` | `/.well-known/ucp` | CORS preflight |

**CORS Headers:**
```
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, OPTIONS
Access-Control-Allow-Headers: Accept, Content-Type
```

**Response Structure:**
```json
{
  "ucp": {
    "version": "2026-01-11"
  },
  "business": {
    "name": "Shop Name",
    "url": "https://your-deployed-url.com"
  },
  "capabilities": {
    "dev.ucp.shopping.checkout": [{
      "version": "2026-01-11",
      "spec": "https://ucp.dev/specs/shopping/checkout",
      "schema": "https://ucp.dev/schemas/shopping/checkout.json"
    }]
  },
  "services": {
    "dev.ucp.shopping": [{
      "version": "2025-11-25",
      "endpoint": "https://your-deployed-url.com/api/mcp",
      "transport": "mcp"
    }]
  },
  "payment_handlers": { ... }
}
```

**Dynamic URL:** The `business.url` and `services[*].endpoint` are automatically detected from request headers at runtime, supporting dynamic deployments.

### Pages

| URL | Description |
|-----|-------------|
| `/` | Redirects to `/merchant` |
| `/merchant` | Merchant center (products + orders) |
| `/checkout/:id` | Checkout page (UCP continue_url target) |
