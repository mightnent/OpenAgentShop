# MCP-UI Guide

MCP-UI enables AI agents to render rich, interactive HTML components directly in the chat interface. OpenAgentShop auto-generates these components from your product catalog.

## How MCP-UI Works

When an MCP tool returns results, it can include HTML alongside text. MCP hosts (like Claude Desktop) render this HTML in an embedded panel, creating a rich shopping experience within the conversation.

### Delivery Modes

OpenAgentShop supports two MCP-UI delivery modes simultaneously:

#### Classic Mode
HTML is embedded directly in the tool response `content[]` array:
```json
{
  "content": [
    { "type": "text", "text": "Found 3 products..." },
    {
      "type": "resource",
      "resource": {
        "uri": "ui://my-shop/products/list",
        "mimeType": "text/html",
        "text": "<html>...</html>"
      }
    }
  ],
  "_meta": {
    "ui": { "resourceUri": "ui://my-shop/products/list" }
  }
}
```

#### MCP Apps Mode (Resource-Based)
HTML is registered as a resource and fetched separately via `resources/read`:
```
server.resource("ui-resource", "ui://my-shop/{path}", ...)
```

Both modes are generated by default for maximum compatibility across hosts.

## Generated Components

### Product List

A horizontally scrollable card grid showing products. Generated when `list_products` or filtered queries return results.

Features:
- Scroll-snap for smooth horizontal browsing
- Price display with discount strikethrough
- Tier badges (color-coded)
- Custom attribute display (attributes with `display_in_list: true`)
- "View Details" button triggers `get_product` tool call

### Product Detail

A full product card with all information. Generated when `get_product` returns.

Features:
- Product image (from media array)
- Full description
- Custom attribute sections (attributes with `display_in_detail: true`)
- Array attributes rendered as bullet lists
- "Purchase" button triggers `create_checkout` tool call

### Recommendations

A ranked list of recommended products. Generated when `recommend_products` returns.

Features:
- First item highlighted as "Best Match"
- Sorted by price
- "View Details" button for each item

### Order Confirmation

A success card shown after checkout completion. Generated when `complete_checkout` succeeds.

Features:
- Checkmark icon
- Order ID display
- Line item breakdown
- Totals (subtotal, tax, total)
- Confirmation email notice

## Communication Pattern

MCP-UI components communicate with the host via `postMessage`:

```javascript
// Button click in MCP-UI HTML
window.parent.postMessage({
  type: 'tool',
  payload: {
    tool: 'get_product',
    args: { productId: 42 }
  }
}, '*');
```

The MCP host intercepts this message and automatically calls the specified tool, creating a seamless browsing experience.

## Theming

Customize the look of MCP-UI components through your catalog's branding or SDK config:

### Via Catalog JSON

```json
{
  "shop": {
    "branding": {
      "primary_color": "#2563eb",
      "secondary_color": "#64748b"
    }
  }
}
```

### Via SDK Config (Programmatic)

```typescript
generateProject(catalog, "./my-store", {
  ui: {
    theme: {
      primaryColor: "#2563eb",
      secondaryColor: "#64748b",
      fontFamily: "Inter, sans-serif",
      borderRadius: "8px"
    },
    customCss: ".card { border: 1px solid #e2e8f0; }"
  }
});
```

### Available Theme Properties

| Property | Default | Description |
|----------|---------|-------------|
| `primaryColor` | `#1a1a1a` | Buttons, price text, accents |
| `secondaryColor` | `#666666` | Secondary text |
| `fontFamily` | System font stack | Font family for all text |
| `borderRadius` | `12px` | Card corner radius |
| `customCss` | `""` | Additional CSS injected into all components |

## Controlling Attribute Display

Custom attributes have two display flags:

- `display_in_list: true` - Shows the attribute in product list cards
- `display_in_detail: true` - Shows the attribute in the product detail view

Array attributes (`string[]`) are rendered as comma-separated values in list views and as bullet lists in detail views.

```json
{
  "custom_attributes": [
    {
      "key": "features",
      "type": "string[]",
      "label": "Features",
      "display_in_list": false,
      "display_in_detail": true
    },
    {
      "key": "color",
      "type": "string",
      "label": "Color",
      "display_in_list": true,
      "display_in_detail": true
    }
  ]
}
```

## Extending MCP-UI

After generating the project, you can modify `src/lib/mcp-ui.ts` to customize the HTML templates. The file contains four functions:

1. `generateProductListHtml(products)` - Product grid
2. `generateProductDetailHtml(product, media)` - Product detail
3. `generateRecommendationsHtml(products)` - Recommendations
4. `generateOrderConfirmationHtml(orderData)` - Order success

Each function returns a complete HTML document string. You can modify the layout, add new sections, or change the styling.
